const CACHE_NAME="peta-cache-v1";self.addEventListener("install",(e=>{console.log("[SW] Install event"),self.skipWaiting()})),self.addEventListener("activate",(e=>{console.log("[SW] Activate event"),self.clients.claim()})),self.addEventListener("fetch",(e=>{"GET"===e.request.method&&e.request.url.startsWith(self.location.origin)&&e.respondWith(caches.open(CACHE_NAME).then((t=>t.match(e.request).then((n=>n?(console.log("[Cache] Hit:",e.request.url),n):fetch(e.request).then((n=>(n&&200===n.status&&(t.put(e.request,n.clone()),console.log("[Cache] Stored:",e.request.url)),n))).catch((n=>(console.log("[Offline] Fetch failed:",e.request.url),t.match(e.request).then((e=>e||new Response("Offline - Resource not available",{status:503,statusText:"Service Unavailable",headers:new Headers({"Content-Type":"text/plain"})})))))))))))})),self.addEventListener("push",(e=>{console.log("[Push] Push event received:",e);let t={title:"Notifikasi Peta Dunia",body:"Anda menerima pesan baru",icon:"/favicon.png"};if(e.data)try{const n=e.data.json();t={title:n.title||t.title,body:n.body||t.body,icon:n.icon||t.icon}}catch(n){t.body=e.data.text()}console.log("[Push] Showing notification:",t),e.waitUntil(self.registration.showNotification(t.title,{body:t.body,icon:t.icon,tag:"peta-notification",requireInteraction:!1}))})),self.addEventListener("notificationclick",(e=>{console.log("[Notification] Clicked:",e.notification.title),e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then((e=>{for(let t=0;t<e.length;t++)if("/"===e[t].url&&"focus"in e[t])return e[t].focus();if(clients.openWindow)return clients.openWindow("/")})))}));